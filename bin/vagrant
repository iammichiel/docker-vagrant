#!/bin/bash

# Links the personnal folder with the shared folder
rm -rf /home/vagrant/projects
ln -fs /data /home/vagrant/projects

# Update the system
locale-gen fr_FR.UTF-8

# Install the mose used dev packages
apt-get update && apt-get install -y \
  php5-cli \
  php5-curl \
  vim \
  wget \
  git \
  htop \
  linux-image-extra-virtual \
  linux-headers-generic \
  linux-headers-virtual \
  linux-image-virtual \
  mysql-client \
  zsh \
  curl \
  nodejs \
  npm \
  python-dev \
  python-pip \
  unzip

# Nodejs does not create the node executable.
update-alternatives --install /usr/bin/node nodejs /usr/bin/nodejs 100

# Installing composer
curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer

# Install Docker
wget -qO- https://get.docker.com/ | sh
usermod -a -G docker vagrant

# Installing docker-composer
curl -L https://github.com/docker/compose/releases/download/1.5.2/docker-compose-`uname -s`-`uname -m` > /tmp/docker-compose
chmod +x /tmp/docker-compose
mv /tmp/docker-compose /usr/local/bin/docker-compose

# Setting default shell to ZSH
chsh -s /bin/zsh vagrant
sudo -u vagrant -H sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
sed -i 's/fletcherm/clean/g' /home/vagrant/.zshrc
echo "cd projects" >> /home/vagrant/.zshrc

# Restarting services.
service docker restart
